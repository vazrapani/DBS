<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>동빈 스토어</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <link href="styles.css" rel="stylesheet">
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=c3ps2p9f1s"></script>
    <style>
    /* 카테고리별 상품 카드 배경 스타일 */
    .category-section[data-category="red-pepper"] .product-card {
        background-image: url('images/bg_card_red.png');
    }

    .category-section[data-category="perilla"] .product-card {
        background-image: url('images/bg_card_perilla.png');
    }

    .category-section[data-category="processed"] .product-card {
        background-image: url('images/bg_card_goods.png');
    }

    /* 버튼 press 효과 */
    .call-button {
        position: relative;
        transform: translateY(0);
        transition: transform 0.1s ease;
        cursor: pointer;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
        user-select: none;
        will-change: transform;
    }

    .call-button:active {
        transform: translateY(2px);
    }

    /* 버튼 hover 효과 */
    @media (hover: hover) {
        .call-button:hover {
            transform: translateY(0);
        }
    }
    </style>
<script>
let currentActiveDot = -1;
function updateActiveByScroll(category) {
    const section = document.querySelector(`.category-section[data-category="${category}"]`);
    if (!section) return;
    const cards = section.querySelectorAll('.product-card');
    if (!cards.length) return;

    let minDiff = Infinity;
    let activeIdx = 0;
    const centerY = window.innerHeight / 2;

    cards.forEach((card, idx) => {
        const rect = card.getBoundingClientRect();
        const cardCenter = rect.top + rect.height / 2;
        const diff = Math.abs(cardCenter - centerY);
        if (diff < minDiff) {
            minDiff = diff;
            activeIdx = idx;
        }
    });

    if (activeIdx !== currentActiveDot) {
        const dots = document.querySelectorAll('.vertical-nav .nav-dot');
        dots.forEach((dot, idx) => {
            dot.classList.toggle('active', idx === activeIdx);
        });
        currentActiveDot = activeIdx;
    }
}

function handleScroll() {
    const sections = document.querySelectorAll('.category-section');
    let maxVisible = 0;
    let activeSection = null;
    const viewportTop = 0;
    const viewportBottom = window.innerHeight;

    sections.forEach(section => {
        const rect = section.getBoundingClientRect();
        // 화면에 보이는 부분 계산
        const visibleTop = Math.max(rect.top, viewportTop);
        const visibleBottom = Math.min(rect.bottom, viewportBottom);
        const visibleHeight = Math.max(0, visibleBottom - visibleTop);
        if (visibleHeight > maxVisible) {
            maxVisible = visibleHeight;
            activeSection = section;
        }
    });

    if (activeSection) {
        const category = activeSection.getAttribute('data-category');
        updateMenuActive(category);
        updateNavigationDots(category);
        updateActiveByScroll(category);
    }
}
</script>
    <script>
        // 카테고리별로 현재 활성 dot 인덱스를 관리
        const currentActiveDotMap = {};

        function updateNavigationDots(category) {
            // 모든 .vertical-nav를 숨김
            document.querySelectorAll('.vertical-nav').forEach(nav => {
                nav.style.display = 'none';
            });
            const section = document.querySelector(`.category-section[data-category="${category}"]`);
            if (!section) return;
            const productCards = section.querySelectorAll('.product-card');
            const cardCount = productCards.length;
            const verticalNav = section.querySelector('.vertical-nav');
            if (!verticalNav) return;
            // 현재 카테고리의 .vertical-nav만 보이게
            verticalNav.style.display = 'flex';
            // dot 개수가 다를 때만 새로 생성 (중복 dot 방지)
            if (verticalNav.childElementCount !== cardCount) {
                verticalNav.innerHTML = '';
                for (let i = 0; i < cardCount; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'nav-dot';
                    dot.addEventListener('click', () => {
                        // dot 클릭 시 모든 dot 비활성화 후 해당 dot만 활성화
                        verticalNav.querySelectorAll('.nav-dot').forEach(d => d.classList.remove('active'));
                        dot.classList.add('active');
                        productCards[i].scrollIntoView({ behavior: 'smooth', block: 'center' });
                        setTimeout(() => {
                            updateActiveByScroll(category);
                        }, 500);
                    });
                    verticalNav.appendChild(dot);
                }
            }
            currentActiveDotMap[category] = -1;
        }

        function updateActiveByScroll(category) {
            const section = document.querySelector(`.category-section[data-category="${category}"]`);
            if (!section) return;
            const cards = section.querySelectorAll('.product-card');
            if (!cards.length) return;
            const verticalNav = section.querySelector('.vertical-nav');
            if (!verticalNav) return;

            let minDiff = Infinity;
            let activeIdx = 0;
            const centerY = window.innerHeight / 2;

            cards.forEach((card, idx) => {
                const rect = card.getBoundingClientRect();
                const cardCenter = rect.top + rect.height / 2;
                const diff = Math.abs(cardCenter - centerY);
                if (diff < minDiff) {
                    minDiff = diff;
                    activeIdx = idx;
                }
            });

            if (currentActiveDotMap[category] !== activeIdx) {
                const dots = verticalNav.querySelectorAll('.nav-dot');
                dots.forEach((dot, idx) => {
                    dot.classList.toggle('active', idx === activeIdx);
                });
                currentActiveDotMap[category] = activeIdx;
            }
        }

        // 메뉴 활성화 함수
        function updateMenuActive(selectedCategory) {
            // 모든 메뉴 아이템 비활성화
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // 선택된 메뉴 아이템 활성화
            const selectedMenuItem = document.querySelector(`.menu-link[data-category="${selectedCategory}"]`).parentElement;
            if (selectedMenuItem) {
                selectedMenuItem.classList.add('active');
            }
        }

        // 전역 함수로 이동
        function moveToCategory(direction) {
            const categoryOrder = ['red-pepper', 'perilla', 'processed'];
            const currentSection = document.elementFromPoint(window.innerWidth / 2, window.innerHeight / 2)
                .closest('.category-section');
            if (!currentSection) return;
            
            const currentCategory = currentSection.getAttribute('data-category');
            const currentIndex = categoryOrder.indexOf(currentCategory);
            let nextIndex;
            
            if (direction === 'next') {
                nextIndex = (currentIndex + 1) % categoryOrder.length;
            } else {
                nextIndex = (currentIndex - 1 + categoryOrder.length) % categoryOrder.length;
            }

            const nextCategory = categoryOrder[nextIndex];
            const nextSection = document.querySelector(`.category-section[data-category="${nextCategory}"]`);
            if (nextSection) {
                nextSection.scrollIntoView({ behavior: 'smooth' });
                // 메뉴 활성화 상태 업데이트
                updateMenuActive(nextCategory);
                // 네비게이션 닷 업데이트
                updateNavigationDots(nextCategory);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // 초기 설정
            const productList = document.getElementById('product-list');
            const verticalNav = document.querySelector('.vertical-nav');
            const categorySections = document.querySelectorAll('.category-section');
            const menuLinks = document.querySelectorAll('.menu-link');

            // 현재 카테고리의 가장 중앙에 가까운 카드 인덱스에 따라 닷과 메뉴를 활성화하는 함수
            function updateActiveByScroll(category) {
                const section = document.querySelector(`.category-section[data-category="${category}"]`);
                if (!section) return;
                const cards = section.querySelectorAll('.product-card');
                if (!cards.length) return;

                let minDiff = Infinity;
                let activeIdx = 0;
                const centerY = window.innerHeight / 2;

                cards.forEach((card, idx) => {
                    const rect = card.getBoundingClientRect();
                    const cardCenter = rect.top + rect.height / 2;
                    const diff = Math.abs(cardCenter - centerY);
                    if (diff < minDiff) {
                        minDiff = diff;
                        activeIdx = idx;
                    }
                });

                if (activeIdx !== currentActiveDot) {
                    const dots = document.querySelectorAll('.vertical-nav .nav-dot');
                    dots.forEach((dot, idx) => {
                        dot.classList.toggle('active', idx === activeIdx);
                    });
                    currentActiveDot = activeIdx;
                }
            }

            // 스크롤 이벤트 리스너 등록
            window.addEventListener('scroll', handleScroll);

            // 메뉴 링크 클릭 이벤트
            menuLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const selectedCategory = this.getAttribute('data-category');
                    const selectedSection = document.querySelector(`.category-section[data-category="${selectedCategory}"]`);
                    if (selectedSection) {
                        selectedSection.scrollIntoView({ behavior: 'smooth' });
                        setTimeout(() => {
                            updateActiveByScroll(selectedCategory);
                        }, 500); // 스크롤 애니메이션 후 강제 갱신
                    }
                });
            });

            // 초기 네비게이션 닷 생성 및 메뉴 활성화
            updateNavigationDots('red-pepper');
            updateMenuActive('red-pepper');
            updateActiveByScroll('red-pepper');

            // 메뉴 버튼 클릭 이벤트
            const menuButton = document.querySelector('.menu-button');
            const menuOverlay = document.querySelector('.menu-overlay');

            menuButton.addEventListener('click', function() {
                const overlay = document.querySelector('.image-overlay');
                const menuOverlay = document.querySelector('.menu-overlay');
                // 이미지 오버레이가 열려 있으면 닫고, 닫힌 후 메뉴 오버레이 열기
                if (overlay && overlay.classList.contains('active')) {
                    fadeOutOverlay(overlay);
                    document.body.style.overflow = '';
                    setTimeout(() => {
                        fadeInOverlay(menuOverlay);
                        document.body.style.overflow = 'hidden';
                    }, 200);
                    return;
                }
                // 메뉴 오버레이가 열려 있으면 닫기
                if (menuOverlay.classList.contains('active')) {
                    fadeOutOverlay(menuOverlay);
                    document.body.style.overflow = '';
                    return;
                }
                // 메뉴 오버레이 열기
                fadeInOverlay(menuOverlay);
                document.body.style.overflow = 'hidden';
            });

            const barTop = document.getElementById('barTop');
            if (barTop) {
                barTop.setAttribute('style', 'transition: all 0.25s cubic-bezier(0.4,0,0.2,1);');
            }
            if (menuButton && barTop) {
                const originalX = 6, originalW = 24, originalY = 9;
                const activeX = 9, activeW = 12, activeY = 18;
                const observer = new MutationObserver(() => {
                    if (menuButton.classList.contains('active')) {
                        barTop.setAttribute('x', activeX);
                        barTop.setAttribute('width', activeW);
                        barTop.setAttribute('y', activeY);
                    } else {
                        barTop.setAttribute('x', originalX);
                        barTop.setAttribute('width', originalW);
                        barTop.setAttribute('y', originalY);
                    }
                });
                observer.observe(menuButton, { attributes: true, attributeFilter: ['class'] });
            }

            const barBottom = document.getElementById('barBottom');
            if (barBottom) {
                barBottom.setAttribute('style', 'transition: all 0.25s cubic-bezier(0.4,0,0.2,1);');
            }
            if (menuButton && barBottom) {
                const originalBX = 6, originalBW = 24, originalBY = 23;
                const activeBX = 22, activeBW = 12, activeBY = 9;
                const observerB = new MutationObserver(() => {
                    if (menuButton.classList.contains('active')) {
                        barBottom.setAttribute('x', activeBX);
                        barBottom.setAttribute('width', activeBW);
                        barBottom.setAttribute('y', activeBY);
                    } else {
                        barBottom.setAttribute('x', originalBX);
                        barBottom.setAttribute('width', originalBW);
                        barBottom.setAttribute('y', originalBY);
                    }
                });
                observerB.observe(menuButton, { attributes: true, attributeFilter: ['class'] });
            }

            // 드래그(스와이프)로 카테고리 이동 기능 + 카드 스프링 애니메이션 추가
            const app = document.querySelector('.app');
            let dragStartX = null;
            let dragging = false;
            let dragThreshold = 50; // 카테고리 전환 임계값(50px)
            let maxDrag = 50; // 카드가 따라가는 최대 이동 px(50px)
            let lastDragDiff = 0;
            let dragCard = null; // 드래그 중인 카드

            // 드래그 중 카드 이동 적용 함수 (한 장만 이동)
            function setCardTranslate(x) {
                if (!dragCard) return;
                dragCard.style.transition = 'none';
                dragCard.style.transform = `translateX(${x}px)`;
            }
            // 카드 스프링 복귀 (한 장만 복귀)
            function resetCardTranslate() {
                if (!dragCard) return;
                dragCard.style.transition = 'transform 0.2s cubic-bezier(0.4,0,0.2,1)';
                dragCard.style.transform = 'translateX(0)';
                setTimeout(() => {
                    if (dragCard) dragCard.style.transition = '';
                    dragCard = null;
                }, 220);
            }

            // 터치 이벤트(모바일)
            app.addEventListener('touchstart', function(e) {
                if (e.touches.length === 1) {
                    dragStartX = e.touches[0].clientX;
                    dragging = true;
                    lastDragDiff = 0;
                    // 드래그 시작한 카드 찾기
                    const touch = e.touches[0];
                    dragCard = document.elementFromPoint(touch.clientX, touch.clientY)?.closest('.product-card');
                }
            });
            app.addEventListener('touchmove', function(e) {
                if (!dragging || e.touches.length !== 1) return;
                const currX = e.touches[0].clientX;
                let diffX = currX - dragStartX;
                if (Math.abs(diffX) > maxDrag) diffX = maxDrag * Math.sign(diffX);
                setCardTranslate(diffX);
                lastDragDiff = diffX;
            });
            app.addEventListener('touchend', function(e) {
                if (!dragging) return;
                const endX = e.changedTouches[0].clientX;
                const diffX = endX - dragStartX;
                if (Math.abs(diffX) > dragThreshold) {
                    if (diffX > 0) moveToCategory('next');
                    else moveToCategory('prev');
                }
                resetCardTranslate();
                dragging = false;
                dragStartX = null;
                lastDragDiff = 0;
            });

            // 마우스 이벤트(PC)
            app.addEventListener('mousedown', function(e) {
                if (e.button !== 0) return;
                dragStartX = e.clientX;
                dragging = true;
                lastDragDiff = 0;
                // 드래그 시작한 카드 찾기
                dragCard = document.elementFromPoint(e.clientX, e.clientY)?.closest('.product-card');
            });
            app.addEventListener('mousemove', function(e) {
                if (!dragging) return;
                const currX = e.clientX;
                let diffX = currX - dragStartX;
                if (Math.abs(diffX) > maxDrag) diffX = maxDrag * Math.sign(diffX);
                setCardTranslate(diffX);
                lastDragDiff = diffX;
            });
            app.addEventListener('mouseup', function(e) {
                if (!dragging) return;
                const endX = e.clientX;
                const diffX = endX - dragStartX;
                if (Math.abs(diffX) > dragThreshold) {
                    if (diffX > 0) moveToCategory('next');
                    else moveToCategory('prev');
                }
                resetCardTranslate();
                dragging = false;
                dragStartX = null;
                lastDragDiff = 0;
            });
        });
    </script>
</head>
<body>
    <div class="app">
        <div class="header-group">
            <header class="top-app-bar">
                <div class="title-medium">
                    <div class="title-wrapper">
                        <h1 class="headline">동빈 스토어</h1>
                        <p class="subheadline">전국 식당 식자재 납품 전문</p>
                    </div>
                </div>
                <div class="menu-button" aria-label="메뉴">
                  <svg class="hamburger-svg" width="36" height="32" viewBox="0 0 36 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect class="bar top" id="barTop" x="6" y="9" width="24" height="3" rx="1.5" fill="#F7F9F4" />
                    <rect class="bar middle" x="6" y="16" width="24" height="3" rx="1.5" fill="#F7F9F4" />
                    <rect class="bar bottom" id="barBottom" x="6" y="23" width="24" height="3" rx="1.5" fill="#F7F9F4" />
                  </svg>
                </div>
            </header>
            <div class="header-divider"></div>
            <nav class="navigation-bar">
                <ul class="menu-list">
                    <li class="menu-item active"><a href="#" class="menu-link" data-category="red-pepper">고추가루</a></li>
                    <li class="menu-item"><a href="#" class="menu-link" data-category="perilla">들깨가루</a></li>
                    <li class="menu-item"><a href="#" class="menu-link" data-category="processed">공산품</a></li>
                </ul>
            </nav>
        </div>

        <!-- 세로 네비게이션 -->
        <div class="vertical-nav">
        </div>

        <!-- 컨텐츠 영역 -->
        <main>
            <div id="product-list">
                <!-- 상품카드 템플릿 (숨김) -->
                <template id="productCardTemplate">
                  <div class="product-card">
                    <div class="product-image-area">
                      <img class="product-image" src="" alt="상품 이미지">
                    </div>
                    <div class="product-info">
                      <div class="product-info-title">
                        <h3 class="product-title"></h3>
                      </div>
                      <div class="product-info-price">
                        <!-- .product-price들이 여기에 바로 들어감 -->
                      </div>
                      <div class="product-info-desc">
                        <p class="product-description"></p>
                      </div>
                    </div>
                    <div class="product-button-group">
                      <a href="tel:010-9002-0797" class="call-button call-button-1">
                        <div class="button-icon">
                          <img src="images/icon-call.svg" alt="전화 아이콘">
                        </div>
                        <span>전화 문의</span>
                      </a>
                      <a href="https://open.kakao.com/o/shaHxdsh" target="_blank" class="call-button call-button-2">
                        <div class="button-icon">
                          <img src="images/icon-kakao.svg" alt="카카오톡 아이콘">
                        </div>
                        <span>카카오톡 문의</span>
                      </a>
                    </div>
                  </div>
                </template>
                <!-- 카테고리별 상품카드 컨테이너 -->
                <div class="category-section" data-category="red-pepper">
                  <div class="vertical-nav"></div>
                  <div class="product-list" id="productList-red-pepper"></div>
                </div>
                <div class="category-section" data-category="perilla">
                  <div class="vertical-nav"></div>
                  <div class="product-list" id="productList-perilla"></div>
                </div>
                <div class="category-section" data-category="processed">
                  <div class="vertical-nav"></div>
                  <div class="product-list" id="productList-processed"></div>
                </div>
                <script>
                async function loadProducts(category) {
                    try {
                        const res = await fetch(`/api/products/${category}`);
                        const data = await res.json();
                        const container = document.getElementById(`productList-${category}`);
                        container.innerHTML = '';
                        if (!data.success || !data.products) return;
                        
                        const template = document.getElementById('productCardTemplate');
                        data.products.slice().reverse().forEach((product, idx) => {
                            const card = template.content.cloneNode(true);
                            const productImage = card.querySelector('.product-image');
                            const productTitle = card.querySelector('.product-title');
                            const productDescription = card.querySelector('.product-description');
                            const priceGroup = card.querySelector('.product-info-price');

                            productImage.src = `/${product.image}`;
                            productImage.alt = product.title || '상품 이미지';
                            productTitle.textContent = product.title;
                            productDescription.textContent = product.description || '';

                            if (priceGroup && product.prices) {
                                priceGroup.innerHTML = '';
                                product.prices.forEach(p => {
                                    priceGroup.innerHTML += `<div class='product-price'><span class='amount'>${p.amount}</span><span class='colon'>:</span><span class='price'>${p.price}</span><span class='unit'>원</span></div>`;
                                });
                            }

                            // 이미지 오버레이 클릭 이벤트 연결
                            productImage.addEventListener('click', function(e) {
                                e.stopPropagation();
                                const overlay = document.querySelector('.image-overlay');
                                const enlargedImage = overlay.querySelector('.enlarged-image');
                                enlargedImage.innerHTML = '';
                                const img = document.createElement('img');
                                img.src = this.src;
                                img.alt = this.alt || '상품 이미지';
                                img.style.width = '360px';
                                img.style.height = 'auto';
                                img.style.display = 'block';
                                enlargedImage.appendChild(img);
                                fadeInOverlay(overlay);
                                document.body.style.overflow = 'hidden';
                            });

                            container.appendChild(card);
                        });
                    } catch (error) {
                        console.error('상품 로드 중 오류:', error);
                    }
                    return Promise.resolve();
                }
                document.addEventListener('DOMContentLoaded', () => {
                    Promise.all([
                        loadProducts('red-pepper'),
                        loadProducts('perilla'),
                        loadProducts('processed')
                    ]).then(() => {
                        updateNavigationDots('red-pepper');
                        updateMenuActive('red-pepper');
                        updateActiveByScroll('red-pepper');
                    });
                });
                </script>
            </div>
        </main>
    </div>
    <!-- 이미지 오버레이 -->
    <div class="image-overlay">
        <div class="close-button">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z" fill="#F7F9F4" fill-opacity="0.9"/>
            </svg>
        </div>
        <div class="enlarged-image"></div>
    </div>

    <!-- 메뉴 오버레이 -->
    <div class="menu-overlay">
        <div class="menu-sections">
            <div class="menu-section active" data-section="greeting">
                <div class="section-header">
                    <span class="section-title">대표 인사말</span>
                    <img src="images/icon-arrow-down.svg" alt="펼치기" class="icon-arrow">
                </div>
                <div class="section-content">
                    <div class="greeting-container">
                        <p id="greetingText" class="greeting-text"></p>
                    </div>
                </div>
            </div>
            <div class="menu-section" data-section="map">
                <div class="section-header">
                    <span class="section-title">찾아오시는 길</span>
                    <img src="images/icon-arrow-down.svg" alt="펼치기" class="icon-arrow">
                </div>
                <div class="section-content">
                    <div class="map-container">
                        <div id="map" style="width:100%;height:250px;border-radius:4px;"></div>
                    </div>
                </div>
            </div>
            <div class="menu-section" data-section="gallery">
                <div class="section-header">
                    <span class="section-title">현장 사진</span>
                    <img src="images/icon-arrow-down.svg" alt="펼치기" class="icon-arrow">
                </div>
                <div class="section-content">
                    <div class="photo-gallery">
                        <div class="gallery-container" id="galleryContainer">
                            <!-- 이미지는 JavaScript로 동적 로드됩니다 -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="menu-section">
                <a href="https://www.instagram.com/midas_21_com/" target="_system" class="section-header no-expand">
                    <span class="section-title">인스타그램</span>
                    <img src="images/icon-link.svg" alt="바로가기" class="icon-arrow" width="24" height="24">
                </a>
            </div>
        </div>
    </div>
    <script>
        // 헤더 높이 + 디바이더 높이만큼 오버레이 위치 자동 조정
        function updateOverlayTop() {
            const header = document.querySelector('.top-app-bar');
            const divider = document.querySelector('.header-divider');
            const overlays = [
                document.querySelector('.image-overlay'),
                document.querySelector('.menu-overlay')
            ];
            if (header && divider) {
                const headerHeight = header.offsetHeight;
                const dividerHeight = divider.offsetHeight;
                overlays.forEach(overlay => {
                    if (overlay) overlay.style.top = (headerHeight + dividerHeight) + 'px';
                });
            }
        }
        window.addEventListener('resize', updateOverlayTop);
        document.addEventListener('DOMContentLoaded', updateOverlayTop);

        // 오버레이 닫기(페이드 아웃 후 display: none) - 메뉴 오버레이일 때 메뉴 버튼 .active 제거
        function fadeOutOverlay(overlay) {
            if (!overlay) return;
            overlay.classList.remove('active');
            setTimeout(() => {
                overlay.style.display = 'none';
                // 메뉴 오버레이일 때 메뉴 버튼 .active 제거
                if (overlay.classList.contains('menu-overlay')) {
                    const menuButton = document.querySelector('.menu-button');
                    if (menuButton) menuButton.classList.remove('active');
                }
            }, 200);
        }
        // 오버레이 열기(페이드 인) - 메뉴 오버레이일 때 메뉴 버튼 .active 추가
        function fadeInOverlay(overlay) {
            if (!overlay) return;
            overlay.style.display = 'flex';
            setTimeout(() => {
                overlay.classList.add('active');
                // 메뉴 오버레이일 때 메뉴 버튼 .active 추가
                if (overlay.classList.contains('menu-overlay')) {
                    const menuButton = document.querySelector('.menu-button');
                    if (menuButton) menuButton.classList.add('active');
                }
            }, 10);
        }

        // 오버레이 배경 클릭 시 닫기
        const imageOverlay = document.querySelector('.image-overlay');
        if (imageOverlay) {
            imageOverlay.addEventListener('click', function() {
                fadeOutOverlay(this);
                document.body.style.overflow = '';
            });
        }
    </script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // 사용자 환경 감지
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const isAndroid = /Android/.test(navigator.userAgent);
        const isMobile = isIOS || isAndroid;

        // 전화 버튼 처리
        document.querySelectorAll('.call-button-1').forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const phoneNumber = '010-9002-0797';
                
                if (isMobile) {
                    window.location.href = `tel:${phoneNumber}`;
                } else {
                    navigator.clipboard.writeText(phoneNumber)
                        .then(() => alert(`전화번호가 복사되었습니다: ${phoneNumber}`));
                }
            });
        });
    });
    </script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // 대표 인사말 fetch 및 표시
        fetch('/api/greeting')
            .then(res => res.json())
            .then(data => {
                const greetingText = document.getElementById('greetingText');
                if (greetingText && data.greeting) {
                    greetingText.textContent = data.greeting;
                }
            })
            .catch(() => {
                // 에러 시 아무것도 표시하지 않음(디자인/기능 영향 없음)
            });
    });
    </script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // 메뉴 오버레이 섹션 토글 (아코디언, 닫힘/열림 모두 동시에 부드러운 height 애니메이션)
        const menuSections = document.querySelectorAll('.menu-section');
        let isTransitioning = false;
        menuSections.forEach(section => {
            const header = section.querySelector('.section-header');
            const content = section.querySelector('.section-content');
            // 인스타그램(외부링크) 섹션은 제외
            if (!header || header.classList.contains('no-expand')) return;
            // 초기 상태: 열려 있으면 height auto, 닫혀 있으면 height 0
            if (section.classList.contains('active')) {
                content.style.height = 'auto';
            } else {
                content.style.height = '0px';
            }
            header.addEventListener('click', function() {
                if (isTransitioning) return; // 트랜지션 중 중복 클릭 방지
                const openedSection = document.querySelector('.menu-section.active');
                if (section.classList.contains('active')) {
                    // 닫기: 현재 높이 → 0
                    const currentHeight = content.scrollHeight;
                    content.style.height = currentHeight + 'px';
                    void content.offsetHeight;
                    content.style.transition = 'height 0.3s cubic-bezier(0.4,0,0.2,1)';
                    isTransitioning = true;
                    content.style.height = '0px';
                    content.addEventListener('transitionend', function handler(e) {
                        if (e.target === content) {
                            section.classList.remove('active');
                            isTransitioning = false;
                            content.removeEventListener('transitionend', handler);
                        }
                    });
                } else {
                    // 열려 있던 섹션 닫기(동시에 트랜지션)
                    if (openedSection && openedSection !== section) {
                        const openedContent = openedSection.querySelector('.section-content');
                        if (openedContent) {
                            openedContent.style.transition = 'height 0.3s cubic-bezier(0.4,0,0.2,1)';
                            openedContent.style.height = openedContent.scrollHeight + 'px';
                            void openedContent.offsetHeight;
                            openedContent.style.height = '0px';
                            openedContent.addEventListener('transitionend', function handler(e) {
                                if (e.target === openedContent) {
                                    openedSection.classList.remove('active');
                                    openedContent.removeEventListener('transitionend', handler);
                                }
                            });
                        }
                    }
                    // 열기: 0 → 실제 높이(px) → auto
                    section.classList.add('active');
                    content.style.transition = 'height 0.3s cubic-bezier(0.4,0,0.2,1)';
                    content.style.height = '0px';
                    void content.offsetHeight;
                    isTransitioning = true;
                    content.style.height = content.scrollHeight + 'px';
                    content.addEventListener('transitionend', function handler(e) {
                        if (e.target === content) {
                            content.style.height = 'auto';
                            isTransitioning = false;
                            content.removeEventListener('transitionend', handler);
                        }
                    });
                }
            });
        });
    });
    </script>
</body>
</html>